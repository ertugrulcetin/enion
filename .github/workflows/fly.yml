name: Fly Deploy
on:
push:
branches:
  - main
env:
FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
jobs:
deploy:
name: Deploy app
runs-on: ubuntu-latest
steps:
  - uses: actions/checkout@v3
  - uses: superfly/flyctl-actions/setup-flyctl@master
  - run:  |
       cd enion-cljs
       npm install
       npm run release
       cp -r resources ../enion-backend
       cd ../enion-backend
       lein uberjar
       flyctl deploy --remote-only
       